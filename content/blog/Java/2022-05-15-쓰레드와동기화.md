---
title: 쓰레드와동기화
date: 2022-05-15 23:39:00 +0900
category: Java
draft: true
---

## 2022-05-15-쓰레드와동기화

## 목차

## 01.쓰레드 그리고 동기화

- 시간이 지나가면서 program 만드는 속도가 많이 줄어듦
  - 이전에 비해 많이 줄어듦

- 이전에 1 ~ 10가지 기술로 개발을 해야했다면 전체를 다 알고 개발을 했음
  - 예를 들어 쓰레드라는 기술이 필요하다면 전부를 알아야했다 물론 전부를 알고 있으면 좋긴함
  - 요새는 위의 10가지 기술을 기반 기술이라고 한다면 이것을 비슷한 여러개를 하나로 묶음
    - 이를 프레임워크라는 용어로 쓰인다고 함, 요즘은 이런 프레임 워크가 많아져서 하나하나 구현할 필요가 없어지는 것
- 요즘은 속도를 더 중요시하지는 않는다 얼마나 원하는 것을 구현하는가를 중요시 함

## 02.쓰레드 이해와 생성

- 실행중인 프로그램을 프로세스라고 함
  - 그 프로세스에서 일이나 작업

- java에서 main()역시 쓰레드이다.

- 흐름을 만드는 주체, 최소단위를 말함

- 멀티 쓰레드는?

  - 하나의 프로세스 안에 2개이상의 쓰레드가 있는 것

  ```java
  Thread ct = Thread.currentThread();
  String name = ct.getName();//쓰레드의 이름을 받아옴
  ```

- 쓰레드 과정

  - Runnable을 구현한 인스턴스 생성
  - Thread 인스턴스 생성
  - Start 메소드 호출

  ```java
  Runnable task = () -> {
  	int n1 = 10;
      int n2 = 20;
      String name = Thread.currentThread().getName();
      System.out.println(name + " : " + (n1 + n2));
  }
  
  Thread t = new Thread(task);
  t.start();//쓰레드 생성 및 실행
  ```

## 03.둘 이상 쓰레드 생성

```java
Runnable task1 = () -> {
    //로직1
}
Runnable task2 = () -> {
    //로직2
}
Thread t1 = new Thread(task1);
Thread t2 = new Thread(task2);

class Task extends Thread{
    public void run(){
	}
}// 이것과 같이 클래스로도 가능하다 하지만 요새는 람다식이 잘되어 있어 람다식으로 한다.
```

### 03.1 Join()

- 쓰레드의 종료를 기다린다. 
- 쓰는 것은 쓰레드가 완료된 후 결과를 출력하고 싶은 경우 쓰레드가 종료하기를 기다리기 위해 사용하는 것

## 04.쓰레드의 동기화

- 싱글 쓰레드에서는 문제가 없음
- 멀티쓰레드를 사용했을 경우 문제가 발생
  - 공유자원에 대한 문제가 발생 
- 쓰레드로 count++ 하는 로직 하나와 count--하는 로직을 만들었을때 
  - 이상적으로 우리는 100번 씩 했다하면 0이 나와야한다고 생각한다.
  - 하지만 우리가 생각한것처럼 0이 나오지 않는다 
  - 이것의 문제가 공유자원을 접근했을때 다른 쓰레드의 동작이 끝나지 않은상태에서 또다른 쓰레드가  공유자원을 가져와서 쓰기 때문에 문제가 발생하는것
- 위의 문제를 방지하기위해서 공유자원을 다른 쓰레드가 쓰고 있을 때 쓰지 못하게 하는 것 이를 쓰레드의 동기화라고 한다.
  - 상호배제를 하는것이라고 생각하면 쉽다.

### 04.1 동기화는 어떻게 하나요?

- synchronized를 선언해주면 됨

  ```java
  synchronized public void increment(){};
  ```

- 동기화 블럭

  ```java
  synchronized (this){
  	count++;
  }
  ```

## 05.쓰레드를 생성하는 더 좋은 방법

- 쓰레드 풀 모델
  - 쓰레드 생성과 소멸은 리소스 소모가 많음
  - 쓰레드 풀은 쓰레드를 재활용하기 위한 모델
  - 여러개 작업이 있는 경우 몇개의 쓰레드가 필요하는지? 이것을 선택하는것이 어려운 문제이다
    - 어떤 프로그램은 싱글쓰레드로 쓰는것이 오히려 성능면에서도 좋기에 적절히 써야한다.

```java
ExecutorService exr = Executors.newSingleThreadExecutor();
exr.submit(task);// 여기서 task는 우리가 만드는 로직이고 쓰레드 풀에 작업 전달
exr.shudown();// 쓰레드 풀과 그 안에 있는 쓰레드 소멸
```

### 05.1쓰레드 풀의 유형

```java
new SingleThreadExecutor;
new FixedThreadPool(3);//숫자만큼 쓰레드 생성유지
new CacheThreadPool; //작업의 수에 맞게 유동적으로 관리
```

