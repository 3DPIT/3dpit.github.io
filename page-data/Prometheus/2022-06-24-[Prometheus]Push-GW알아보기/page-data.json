{"componentChunkName":"component---src-templates-blog-post-js","path":"/Prometheus/2022-06-24-[Prometheus]Push-GW알아보기/","result":{"data":{"site":{"siteMetadata":{"title":"3DPIT Study Blog","author":"[KyeongMinPark]","siteUrl":"https://3dpit.github.io","comment":{"disqusShortName":"","utterances":"3dpit/3dpit.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"e47baa6a-dc06-5c9e-9532-d6a70425299a","excerpt":"2022-06-24-PrometheusPush-GW알아보기 목차 01.Pushgateway란? 02.Pushgateway 설치 02.1 pushgatway 데이터 넣기 02.2 Status 03.인스턴스 확인 | 현재 테스트해봤을때는 안됨 04.실습 01.Pushgateway란? Prometheus를 push방식으로 사용하기 위해 필요 단발성 작업 혹은 배치성 작업에 해당하는 메트릭 수집 용도 02.Pushgateway 설치  pushgateway.yml 링크 연결 후 reload 02.…","html":"<h2 id=\"2022-06-24-prometheuspush-gw알아보기\" style=\"position:relative;\"><a href=\"#2022-06-24-prometheuspush-gw%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0\" aria-label=\"2022 06 24 prometheuspush gw알아보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2022-06-24-[Prometheus]Push-GW알아보기</h2>\n<h2 id=\"목차\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%EC%B0%A8\" aria-label=\"목차 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목차</h2>\n<blockquote>\n<p>01.Pushgateway란?</p>\n<p>02.Pushgateway 설치</p>\n<blockquote>\n<p>02.1 pushgatway 데이터 넣기</p>\n</blockquote>\n<p>02.2 Status</p>\n<p>03.인스턴스 확인 | 현재 테스트해봤을때는 안됨</p>\n<p>04.실습</p>\n</blockquote>\n<h2 id=\"01pushgateway란\" style=\"position:relative;\"><a href=\"#01pushgateway%EB%9E%80\" aria-label=\"01pushgateway란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>01.Pushgateway란?</h2>\n<ul>\n<li>Prometheus를 push방식으로 사용하기 위해 필요</li>\n<li>단발성 작업 혹은 배치성 작업에 해당하는 메트릭 수집 용도</li>\n</ul>\n<h2 id=\"02pushgateway-설치\" style=\"position:relative;\"><a href=\"#02pushgateway-%EC%84%A4%EC%B9%98\" aria-label=\"02pushgateway 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>02.Pushgateway 설치</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">docker run -d --net=host -p 9091:9091 --name pushgateway prom/pushgateway:v1.4.1</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 561px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVQoz63R0QqCMBQG4L1OV95kYF2MwiSUyDeISGylIhYV9IrbI7nztyZIINhFO/BxfnbxszG2TnYI45SiOMUySuD5C6w2WwQ8tHka8G7POSbezPBHser6oOb+Qn17Wof8glPZIC9qkwtkorJnR1Fin50NMYqhG4KjsYVE1NNaD/L3/mVQ+K++0PmTnRV+ytq2JQMuMJc/bG+olIKUkgy48AZeu72bk5qcJwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624153105207\"\n        title=\"image-20220624153105207\"\n        src=\"/static/50a1652230e572b0c76adcfa622d5c5d/410f3/image-20220624153105207.png\"\n        srcset=\"/static/50a1652230e572b0c76adcfa622d5c5d/5a46d/image-20220624153105207.png 300w,\n/static/50a1652230e572b0c76adcfa622d5c5d/410f3/image-20220624153105207.png 561w\"\n        sizes=\"(max-width: 561px) 100vw, 561px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"> cp static_sd.yml pushgateway.yml\n \n vim pushgateway.yml</code></pre></div>\n<ul>\n<li>\n<p>pushgateway.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">scrape_configs</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">job_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'pushgateway'</span>\n  <span class=\"token key atrule\">follow_redirects</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">scrape_interval</span><span class=\"token punctuation\">:</span> 2s\n  <span class=\"token key atrule\">scrape_timeout</span><span class=\"token punctuation\">:</span> 1s\n  <span class=\"token key atrule\">static_configs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">targets</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> 192.168.100.116<span class=\"token punctuation\">:</span><span class=\"token number\">9091</span></code></pre></div>\n</li>\n<li>\n<p>링크 연결 후 reload</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">ln -sf pushgateway.yml promtheus.yml\n\ncurl localhost:9090/-/reload -XPOST -D /dev/stdout</code></pre></div>\n</li>\n</ul>\n<h3 id=\"021-pushgatway-데이터-넣기\" style=\"position:relative;\"><a href=\"#021-pushgatway-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%84%A3%EA%B8%B0\" aria-label=\"021 pushgatway 데이터 넣기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>02.1 pushgatway 데이터 넣기</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">echo &quot;test_metric 1&quot; | curl --data-binary @- http://localhost:9091/metrics/job/t\nest_job</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1120px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVQY042My2rCUBRF84Wd6CCCprVKEk0fUqjg1KFfUigURSgi+BGlJiVJdSDYIAnkBhK0hbC8KjipghvWYD/OUbTyDabe5LpmULk1KGk11HKVglqhWNK4Kqjo1iOD/oAHq8Vzu8vdUwdDZnXznurutm5KGmjyh/IxtXFcj6nz9Q9b8mk7uLJfBiuG70PeXnqMR6+4/hzX8494/vd+r3ChNr9/BD8LgtmEaOWf3OR5jhKGIUII4jg+y64XIiZNM7I1pNlm7w/5gSRJiKKILfrXDDU3N4AQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624154054451\"\n        title=\"image-20220624154054451\"\n        src=\"/static/5f82c9ef2fdf09b4a25e72c40a1c9dd8/f43e4/image-20220624154054451.png\"\n        srcset=\"/static/5f82c9ef2fdf09b4a25e72c40a1c9dd8/5a46d/image-20220624154054451.png 300w,\n/static/5f82c9ef2fdf09b4a25e72c40a1c9dd8/0a47e/image-20220624154054451.png 600w,\n/static/5f82c9ef2fdf09b4a25e72c40a1c9dd8/f43e4/image-20220624154054451.png 1120w\"\n        sizes=\"(max-width: 1120px) 100vw, 1120px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>push<em>failure</em>time_seconds</p>\n<ul>\n<li>실패시 찍히는것</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 959px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAChElEQVQoz5WSW08TURSF52f5ooagMSgRNUaDvuijP8EHY4yUKi1pKaWmKIVASQhyqdoCvUEpFwsttJaWtmqiTiGUAFKmM51LL8s9Ux4kJiSe5Mve+5wzK/vsNczt+w/x4NETtN17jNY77bh6vQ3NLTfRdK0VF5tbcOnKOdD55Ru30HS3HRfoO/98CEwimULQN4H5uRHE4zHs7u6BZfPI53fAnsMvlkW+UMB3bxBpXTe2zW/AHx6B+cnuIBWbwNfNARwcsPjv9YNF1eOH5F1AlRfACKKExU9BBMZn4BubhGfIiYWPM1hei2L58zqWiPDqGlYiUcrXaC8K/1IYg773GHe5MTkXwCgRyeQ0feb45AQjA8Nw2PphM/XC2t2Drk4DXpv7oDda0Gnogb7bAh1FncGs1S+NJjw16PFcb0SXqQ+6rh54Zv0NwXq9DtTkM68QJQliuQxRFMHzPCSKgiCgVCpBoFqWZZwUOZQo/3upWky9VsVq7jdCmUMU8wEc7yyTkComaYKauBqpltScxESOw1EiAW5/HwLtcVSX6c5phzXkOSB3UEWlGIdcTKOiyFAUhaKixTN5pUJPUIC9fVDr/3bI01NWVlcQCoXgCUYQjiSwkUhqRDe/IEaoeSzeiPF4Cu71IKbDPngDi5gLhuBye+k82eiwSKa8Gx6DjYwx976F1eZA/9Cohn3QCbvDqeXW/kFY7A5Y7UPosFnwwmwis/rwikx51mGEy+NtCKqDnfHNY/rDLJwL0xgJTGGK8kn6dVSmTtndK6BMRnFkjMjTTMuiVpdPzVOp1WpgJEnGdvYbkqkMNnJb2MymsJXOIpnOaGxpZDVHq1WaM81QqSgNlLOoM/wDOvkpyQqWtjQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624154231119\"\n        title=\"image-20220624154231119\"\n        src=\"/static/4e8e63d035b0f98bf23401c06a7cdb3c/d7abb/image-20220624154231119.png\"\n        srcset=\"/static/4e8e63d035b0f98bf23401c06a7cdb3c/5a46d/image-20220624154231119.png 300w,\n/static/4e8e63d035b0f98bf23401c06a7cdb3c/0a47e/image-20220624154231119.png 600w,\n/static/4e8e63d035b0f98bf23401c06a7cdb3c/d7abb/image-20220624154231119.png 959w\"\n        sizes=\"(max-width: 959px) 100vw, 959px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n<li>\n<p>push<em>time</em>seconds</p>\n<ul>\n<li>정상적으로 들어온 시간</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 930px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsklEQVQ4y52S2U8TURTG5w9TEsXEFYlLog/G+OabJgajBkGIoNYKFW2wsqooUKUIRQW1FipSZFGBulF2k7IobaEz00Jnys87IwLR+OIkv3zfvXNOcr6TK+07dITDR4+TcfAYu/cfZtvOTNJ37GXL9j1s2rqDzemCrf9g9V/arkzSMg+QlrEfqf/9AF2+Zrq8dfT2dTM6NkEwOEJwZHRVRxg29A9v6NfhIMPjEwRcbj7YShmsrEEa+jSM3+PgndfC+Mgg//Pp/j6Wqh4Qb3AjybKCvy9Ah38AX1cPXl8nb7p7GQx8WmNg6KOpQx8/m34o8JnXH97S1tNOu68LX28/np4+vkxOIYVm5rBct1NgLSb74hVOZedzLv8y1pLSNSw2u6nXbtwyfVGJg9wiKycu53Amt5CzFwo5efo8rqYWpOj8PK1OF+4HTpru19P6sJGXng6ePH/F0+ceWtpe8uyF4V/R0mp4L81tL6h011PnasIp9udsdHOn9hH+nn6kmdA0ZcV2Sq0lWPMuUXTRgv12NTdXueGoxF62fraX3cHmqCCrpJBsy1XyLhWTb7GRlVNAQ/NTJE3XiUYjKHIMJb7MopIgsrBI9A8i0QXm5r4TiURZEF5dUEWPgqyogl+6tLSExEqK8VCY6YiKvhxGT/xA1zVBSqCbpFZW0MJhwmNjJMWK9EgETaAbPh5HT63XSispHd9YipaAzPfgQ6KjtahyGDWeQFXVX4gmdXKSOfEOQ4IZ8UajoRDK1Dfk2VlkUROLxUgkxITJZFKMvogSE7HkuMlfcQWKiKnLMrqIZ6AJr4nImujXNG0N6cd8mBpnI2XVddgaKrA9Lqf8bi2VNfVU3Ksz1VFVg7fTT1I0mNMmEsR/I84GRhJDJSO3WWRerhLfoAJFNRa+TErsKmXsdCPG3QZ+ApGmaGK0It1fAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624154343616\"\n        title=\"image-20220624154343616\"\n        src=\"/static/d73fed0bb0144928a6ec8af1ecc2b618/416ee/image-20220624154343616.png\"\n        srcset=\"/static/d73fed0bb0144928a6ec8af1ecc2b618/5a46d/image-20220624154343616.png 300w,\n/static/d73fed0bb0144928a6ec8af1ecc2b618/0a47e/image-20220624154343616.png 600w,\n/static/d73fed0bb0144928a6ec8af1ecc2b618/416ee/image-20220624154343616.png 930w\"\n        sizes=\"(max-width: 930px) 100vw, 930px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n<li>\n<p><strong>실패의 상황</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">&quot;test_metric 1 1&quot; | curl --data-binary @- http://localhost:9091/metrics/job\n/test_job</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 936px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACrklEQVQ4y5WS+U9TQRDH378JxvuIGDxjYoy/aDRG4gEebYFHC6UUKLRSEKxUlLSCXB6BgoANhCKivYAelPdeWz7uPpWYqDFO8s3O7M7O9R2l6swFLl6+xqlzVzhx/hKHzl7gQPU5E5Unq6k4fIKK/UeoOHD0d8j7g8eorDrNvuqzVB6vQlleWSMUdDEermfe7SBT28BmnY0taxPZplaMpWVKQKlYpFQq7aEo7d0yxuYWG7YWktfvkh9+hbL+NcFiJMTSQoD4yAtKodfo4VG00IiJ4qc1yn8ISHkXKWVNQ3s7zc7IONvRJZRCoUC7b4BGpw9LSzt3Gh1YXR14A0G6nw7i8ffT6fXT9bgPj6+Xju4eunx91LRbudnwkDqrndpmF7ftThJbGZRsLofL40N1urGqDh7YVCyNzTS1uE3Ie1XqIomjvQu1tQPV1cl9h/BV7TwSvg/r7TywqiSTKZTdXVF6WeefIlvNZkH6y5b/IgpisJPRNMHZNMnVEOnYENlMmlwuL5BDdpDL59mMRonNL5CMxUisrrIVWyGbSon3PFmRKJPJmrM1A37OwVwCtM0ZjI13FI0CRVmRJOInGeKzFo+TX19n50scNjK/VPqdINmtIGWHUDjM4OAz/IEwz4YnGJ14w+j4FCNjkyakPjop7iammJx6z9DYK9wv/fQGntP3NEjvgCDQP0BGVKrI1lyeHhrE4B/ZHFhszTjaOgU82MXw7YIEaTeKd4vqpMHeRq2qctVyj5o6q4lbtRZu3L5PKpVG2RZrExgaxtszgDvox/ncK1akn66eJya8InOHWJuZuXl0XRfzzFHYLmAUdDS5g9rOj1PDMAwUXTdYFAs5E5nn7ccIU9FpInMLRD4smEFmxTk9+4Gv8YQ5S/lJQjf0Pd20RbLvpPyHmCv2D/kG3xF3TpQFX9YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624154543143\"\n        title=\"image-20220624154543143\"\n        src=\"/static/ad44f030fea03f90afd19a1e76eb8a68/6d2da/image-20220624154543143.png\"\n        srcset=\"/static/ad44f030fea03f90afd19a1e76eb8a68/5a46d/image-20220624154543143.png 300w,\n/static/ad44f030fea03f90afd19a1e76eb8a68/0a47e/image-20220624154543143.png 600w,\n/static/ad44f030fea03f90afd19a1e76eb8a68/6d2da/image-20220624154543143.png 936w\"\n        sizes=\"(max-width: 936px) 100vw, 936px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li>Last push failed가 되고 실패한 시간이 value로 표시</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"022-status\" style=\"position:relative;\"><a href=\"#022-status\" aria-label=\"022 status permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>02.2 Status</h2>\n<ul>\n<li>\n<p>현재 동작중이 pushgate 정보와 옵션이 나타나 있음</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 941px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQ4y6WT6U7CQBRG+/6vYhAVDCL4EOpPVqVIF1oKnW5sn/e7bdCExaiTnMyamTP3zlg3jXvcNVu4lfqqVsf1TQO1+h3qt020O094eOwe0Wp3hO4JOrAWiwVs24Y/n8P35/A8DxPpB0GAvxRrLhtNJjaMMQhlc27IjX3fh+u6iuf5OvYxmyEIQ8RxjNVq9Y2ynyQpLNr0B0OMx2O8vb1jMBzBlQ0ulf1+fxYxDGBPp3rqcrnUq9KSxl8m8cGCY6fgXJpmsNiw7SmKotATWEfRUhYZXbDdbn+FxrDX6yMSuyRJ1JKxYihmjoO4Mi0xan4KzmeZGEZRpEnJslxP4CDH8jzHerOpTt5VbLGRsXOoIWPGZNDkYPgxUztm2HGIozDzplpnjJCUlH2DTCSslahy4W5XZolmTABNj5C5olijWFdIvA99afNGmhQmgXUYLrCWyf8Ui/F7fnnFSN5hvz+QZxNqPHK1KS7Ca6ZizjbXE4sxm8o7ZJ2mKWI1jrT/E67r6c/R28kv4zf+BIHC3Lypuz10AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624154708600\"\n        title=\"image-20220624154708600\"\n        src=\"/static/677fcf2893cc59c5677a6197fb284eb3/a8417/image-20220624154708600.png\"\n        srcset=\"/static/677fcf2893cc59c5677a6197fb284eb3/5a46d/image-20220624154708600.png 300w,\n/static/677fcf2893cc59c5677a6197fb284eb3/0a47e/image-20220624154708600.png 600w,\n/static/677fcf2893cc59c5677a6197fb284eb3/a8417/image-20220624154708600.png 941w\"\n        sizes=\"(max-width: 941px) 100vw, 941px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n</ul>\n<h2 id=\"03인스턴스-확인--현재-테스트해봤을때는-안됨\" style=\"position:relative;\"><a href=\"#03%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%ED%99%95%EC%9D%B8--%ED%98%84%EC%9E%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%B4%EB%B4%A4%EC%9D%84%EB%95%8C%EB%8A%94-%EC%95%88%EB%90%A8\" aria-label=\"03인스턴스 확인  현재 테스트해봤을때는 안됨 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>03.인스턴스 확인 | 현재 테스트해봤을때는 안됨</h2>\n<ul>\n<li>문제의 원인은 각각의 컨테이너가 다른 network를 공유해서 그런듯</li>\n<li>prometheus에서 test_metric를 하면 아래같이 나옴</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 663px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVQ4y52R227TQBCGfdkDkLSx40Nsx4f4GNtJHOfQJiRpQqFFIJCQkGh5BySeCy4QD/gzu0lMXBBSufj0z87s/rszKyzWr3D79gPevP+I+eoliukCo4slxrMrFKTT+Qb55DlGl0tem8zXPJ8NL5DmU062U4aQ9CfIR5cYjmdI+yPE2RBJr0Cc5gi7A3SzAkHco3zB2df8KNtCNT8elGtBCl9ANGM0dRei5iBOBrhaX5P2kPXJPMuRJAm0aAHFn0I2XCjtAKoVkfpECDW9gWK6UO0YQpjSof6YCpSwPGi2B4NinTZw5bEDzdih2xy1xOL5/Vrww5TayqFYdDOZcW21SzQ6oJKW6A9ivZoXFM3EIB/DdnzI7oQMU6iasX0FbRAlFWxPxfQAVjtECLt9rK5f4+jkFKdPa6idNVCrn+Po+ASSrGJz+w6yalDcIvSSpqLzHNOKodOJMJmtaF4OOl6IME7R8SMYpg3b9bHc3MALunA6IeVjuF5UwvJtGhO7sDRUtDZM+oxOkNC3pwiipDzITCzHozikOOBaNYy5ITPaqyA3JYhnz9CoP4EkiruWtq08ZN/q7/VfWlZnX+DcfYN99x1y/glKU6Tftf4Y9r9gLe8RlPlXWPc/YH3+SYb3UKQGbXqcYeWFsnQOqX7MYe2zmR4O+dGG/DUtm3AqZrL2f6a/ADVniIN3QD/WAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624155842700\"\n        title=\"image-20220624155842700\"\n        src=\"/static/07d6d26cfff8f79504caade7a0f8897b/0786c/image-20220624155842700.png\"\n        srcset=\"/static/07d6d26cfff8f79504caade7a0f8897b/5a46d/image-20220624155842700.png 300w,\n/static/07d6d26cfff8f79504caade7a0f8897b/0a47e/image-20220624155842700.png 600w,\n/static/07d6d26cfff8f79504caade7a0f8897b/0786c/image-20220624155842700.png 663w\"\n        sizes=\"(max-width: 663px) 100vw, 663px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>인스턴스 추가</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">echo &quot;test_metric 1&quot; | curl --data-binary @- http://localhost:9091/metrics/job/test_job/instance/batch-server</code></pre></div>\n</li>\n<li>\n<p>인스턴스 삭제</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">curl -XDELETE http://localhost:9091/metrics/job/test_job/instance/batch-server</code></pre></div>\n<ul>\n<li>pushgateway에서 매트릭을 삭제하지 않으면 프로메테우스가 계속에서 수집해가지 유의</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"04실습\" style=\"position:relative;\"><a href=\"#04%EC%8B%A4%EC%8A%B5\" aria-label=\"04실습 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>04.실습</h2>\n<ul>\n<li>\n<p>bach 작업을 하고 해당 작업이 실패하면 -1</p>\n<ul>\n<li>성공시 배치작업을 하는데 걸리는 시간</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">mkdir batch\n\ncd batch/\n\nnpm init -y\n\nnpm i waait\n\nnpm i prom-client\n\nvim work.js</code></pre></div>\n<ul>\n<li>\n<p>work.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> wait <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'waait'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Registry<span class=\"token punctuation\">,</span> Pushgateway<span class=\"token punctuation\">,</span> Gauge <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'prom-client'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> register <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Registry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> gauge <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Gauge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch_process_time_second'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">help</span><span class=\"token operator\">:</span> <span class=\"token string\">'Time taken for batch job to complete'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">registers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>register<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">batchJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'batch job failed'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">await</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">await</span> <span class=\"token function\">batchJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\tgauge<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tgauge<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">const</span> gateway <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Pushgateway</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:9091'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> register<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> gateway<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token literal-property property\">jobName</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token literal-property property\">groupings</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">instance</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch-server'</span><span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA20lEQVQY043OS0sCcRjF4fm+rVy0CgQ35XiZvGC7Nm2KUETS8jY4MCVW8ncGyQhUQrysrLHJGZgRfl52gUIvPIvDgcMrnUVkTkKnHAdlIkqKRPriDyWZIaokiZ2niScOSGWIyXHCRwGk0bCD3hbUxJj59w+e5/FlW1jWgoW1yb7Pv261go8+UvPF4Oo6S6FYQtV0KqpGvlome1fi8vaGXOEevfnMYPiJ4zjYtr3fcsmv7yF1e+881Bu0XgXC6NLumJjmGy1DUH7SqDceKVZUJtPZ7vvtqOu6+226NcyaD9RfqXSTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624161118033\"\n        title=\"image-20220624161118033\"\n        src=\"/static/2cdcc001b49f993ca2b41cf27feffab4/c1b63/image-20220624161118033.png\"\n        srcset=\"/static/2cdcc001b49f993ca2b41cf27feffab4/5a46d/image-20220624161118033.png 300w,\n/static/2cdcc001b49f993ca2b41cf27feffab4/0a47e/image-20220624161118033.png 600w,\n/static/2cdcc001b49f993ca2b41cf27feffab4/c1b63/image-20220624161118033.png 1200w,\n/static/2cdcc001b49f993ca2b41cf27feffab4/d61c2/image-20220624161118033.png 1800w,\n/static/2cdcc001b49f993ca2b41cf27feffab4/3e992/image-20220624161118033.png 1902w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n<li>\n<p>프로메테우스에서 확인</p>\n<ul>\n<li>batch<em>process</em>time_second </li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1014px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVQoz42R2U7DMBBF/Q+0ie04zuKkTptASxfKUiFACAmQkHhAFb/HE+InLzMuLRXwwMPRjJe5M9cWd/dPWF5c4XhxgdlyhenJKuQcF2eXGM9O0R7N0E0W6MY/oL32aI7J/ByPz2vcPjxDRCpDkntMpgsMmhaeqPwhVDWHsg4689DFCMoU36Ruw26Pcp0SCYRK+UIBkzuYjMgrJLaEpIsyyTaFQbyCygahiXITqKKjvA7npjlF0l5DNSsIWw8RFx6ShCSJhkhCaVYi4WYsyt057rDQJoMO5xaj8RJu/Qbz8g5ROI+eGUJqi36sgwjnW2KVEvaLdLfW5IAFt2zti7So0OvHVGxw0IvCR5Q0NU/C4ik/g91M+zuSmMlDE0kuNNUIl1uUrg4ivunoYzrUfoSyagJ+eIhqMIKj89q3Ie6v83IQnFh6KnYr1HSNyLaIYoW+NGQ7QURxy8/1X/CULMxuRPH6gbi5gYxl+Iz99/svbJmFOX4CMN37+mkCQ8EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624161244128\"\n        title=\"image-20220624161244128\"\n        src=\"/static/785e693d2a488d549fed8ca8a5d34028/d7ab4/image-20220624161244128.png\"\n        srcset=\"/static/785e693d2a488d549fed8ca8a5d34028/5a46d/image-20220624161244128.png 300w,\n/static/785e693d2a488d549fed8ca8a5d34028/0a47e/image-20220624161244128.png 600w,\n/static/785e693d2a488d549fed8ca8a5d34028/d7ab4/image-20220624161244128.png 1014w\"\n        sizes=\"(max-width: 1014px) 100vw, 1014px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n<li>\n<p>3초마다 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">watch -n 3 &#39;node worker.js&#39;</code></pre></div>\n</li>\n<li>\n<p>해당 메트릭 가져가고나서 삭제하는 소스</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> wait <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'waait'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Registry<span class=\"token punctuation\">,</span> Pushgateway<span class=\"token punctuation\">,</span> Gauge <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'prom-client'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> register <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Registry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> gauge <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Gauge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch_process_time_second'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">help</span><span class=\"token operator\">:</span> <span class=\"token string\">'Time taken for batch job to complete'</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token literal-property property\">registers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>register<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">batchJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'batch job failed'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">await</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> main <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">await</span> <span class=\"token function\">batchJob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\tgauge<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tgauge<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">const</span> gateway <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Pushgateway</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:9091'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> register<span class=\"token punctuation\">)</span>\n\tgateway<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token literal-property property\">jobName</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch'</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token literal-property property\">groupings</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">instance</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch-server'</span><span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\tgateway<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token literal-property property\">jobName</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token literal-property property\">groupings</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">instance</span><span class=\"token operator\">:</span> <span class=\"token string\">'batch-server'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4000</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>","frontmatter":{"title":"Prometheus Push GW알아보기","date":"June 24, 2022"}}},"pageContext":{"slug":"/Prometheus/2022-06-24-[Prometheus]Push-GW알아보기/","previous":{"fields":{"slug":"/Prometheus/2022-06-24-[Prometheus]PromQL알아보기/"},"frontmatter":{"title":"Prometheus PromQL알아보기"}},"next":{"fields":{"slug":"/Algorithm/2022-06-24-2021카카오블라인드-메뉴리뉴얼/"},"frontmatter":{"title":"2021카카오블라인드 메뉴리뉴얼"}}}},"staticQueryHashes":["2486386679","3128451518"]}