{"componentChunkName":"component---src-templates-blog-post-js","path":"/Prometheus/2022-06-24-[Promethues]메트릭-유형-알아보기/","result":{"data":{"site":{"siteMetadata":{"title":"3DPIT Study Blog","author":"[KyeongMinPark]","siteUrl":"https://3dpit.github.io","comment":{"disqusShortName":"","utterances":"3dpit/3dpit.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"83160cc5-becf-539c-8675-fb6d47cecbca","excerpt":"2022-06-24-Promethues메트릭-유형-알아보기 목차 01.메트릭 종류 02.코딩 02.2 프로메테우스 클라이언트 02.3 서버에 요청 매트릭 정보 확인 03.node express framework를 통한 summary 데이터 알아보기 03.해당 서버로 요청하기 01.메트릭 종류 Count: 누적 개수 Gauge: 현재 상태 Histogram: 특정 기간 동안의 집계 Summary: Histogram과 유사, Quantile 02.코딩 02.2 프로메테우스 클라이언트 02.…","html":"<h2 id=\"2022-06-24-promethues메트릭-유형-알아보기\" style=\"position:relative;\"><a href=\"#2022-06-24-promethues%EB%A9%94%ED%8A%B8%EB%A6%AD-%EC%9C%A0%ED%98%95-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0\" aria-label=\"2022 06 24 promethues메트릭 유형 알아보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2022-06-24-[Promethues]메트릭-유형-알아보기</h2>\n<h2 id=\"목차\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%EC%B0%A8\" aria-label=\"목차 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목차</h2>\n<blockquote>\n<p>01.메트릭 종류</p>\n<p>02.코딩</p>\n<p>02.2 프로메테우스 클라이언트</p>\n<blockquote>\n<p>02.3 서버에 요청</p>\n<blockquote>\n<p>매트릭 정보 확인</p>\n</blockquote>\n</blockquote>\n<p>03.node express framework를 통한 summary 데이터 알아보기</p>\n<p>03.해당 서버로 요청하기</p>\n</blockquote>\n<h2 id=\"01메트릭-종류\" style=\"position:relative;\"><a href=\"#01%EB%A9%94%ED%8A%B8%EB%A6%AD-%EC%A2%85%EB%A5%98\" aria-label=\"01메트릭 종류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>01.메트릭 종류</h2>\n<ul>\n<li>Count: 누적 개수</li>\n<li>Gauge: 현재 상태</li>\n<li>Histogram: 특정 기간 동안의 집계</li>\n<li>Summary: Histogram과 유사, Quantile</li>\n</ul>\n<h2 id=\"02코딩\" style=\"position:relative;\"><a href=\"#02%EC%BD%94%EB%94%A9\" aria-label=\"02코딩 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>02.코딩</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">apt install -y python3-pip\n\n# 프로메테우스 클라이언트 설치\npython3 -m pip install prometheus_client \n\n# agent 만들 디렉토리 생성\nmkdir agent-python\ncd agent-pyhon\n\n# main.py 생성\nvim main.py</code></pre></div>\n<h2 id=\"022-프로메테우스-클라이언트\" style=\"position:relative;\"><a href=\"#022-%ED%94%84%EB%A1%9C%EB%A9%94%ED%85%8C%EC%9A%B0%EC%8A%A4-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8\" aria-label=\"022 프로메테우스 클라이언트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>02.2 프로메테우스 클라이언트</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> http<span class=\"token punctuation\">.</span>server\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">from</span> prometheus_client <span class=\"token keyword\">import</span> Histogram<span class=\"token punctuation\">,</span> start_http_server\n\nhistogram <span class=\"token operator\">=</span> Histogram<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'response_time_histogram'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'Response time for a request'</span><span class=\"token punctuation\">,</span>\n        buckets<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.0003</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.00035</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.0004</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.0005</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>BaseHTTPRequestHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_GET</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        start <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>send_response<span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>wfile<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">b\"Histogram Test\"</span><span class=\"token punctuation\">)</span>\n        histogram<span class=\"token punctuation\">.</span>observe<span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    start_http_server<span class=\"token punctuation\">(</span><span class=\"token number\">8081</span><span class=\"token punctuation\">)</span>\n    server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>HTTPServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Handler<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Exporter running on 8081'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server running on 8080'</span><span class=\"token punctuation\">)</span>\n    server<span class=\"token punctuation\">.</span>serve_forever<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"023-서버에-요청\" style=\"position:relative;\"><a href=\"#023-%EC%84%9C%EB%B2%84%EC%97%90-%EC%9A%94%EC%B2%AD\" aria-label=\"023 서버에 요청 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>02.3 서버에 요청</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">curl -s http://localhost:8080\ncurl http://localhost:8080\ncurl http://localhost:8080 --http0.9\n\nwatch -n 0.1 &#39;curl http://localhost:8080&#39;\n\n# 추가 정보 없이 silent 추가\nwatch -n 0.1 &#39;curl -s http://localhost:8080&#39; </code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 953px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeUlEQVQI1zWOSQpAIQxD/955whFR8f5X7CcFF4+mIQ39cs4EQgjUe6dSCvO0c44xxpD3nr0xBtVa2bfW8sQ9Mh+MlBKbrwz7nJPuvQz0WovOOVy092aNW5Qgj6m1pg+B1hp/iQCAjjGSEIKUUiSl5PArgIf98b6D/wNrcUpcC/5SzgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624111342045\"\n        title=\"image-20220624111342045\"\n        src=\"/static/f2cd923ff66942eb7e553b8a9921f943/38124/image-20220624111342045.png\"\n        srcset=\"/static/f2cd923ff66942eb7e553b8a9921f943/5a46d/image-20220624111342045.png 300w,\n/static/f2cd923ff66942eb7e553b8a9921f943/0a47e/image-20220624111342045.png 600w,\n/static/f2cd923ff66942eb7e553b8a9921f943/38124/image-20220624111342045.png 953w\"\n        sizes=\"(max-width: 953px) 100vw, 953px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h4 id=\"매트릭-정보-확인\" style=\"position:relative;\"><a href=\"#%EB%A7%A4%ED%8A%B8%EB%A6%AD-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8\" aria-label=\"매트릭 정보 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>매트릭 정보 확인</h4>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">watch -n 0.1 &#39;curl -s http://localhost:8081 | grep response&#39; </code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 958px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0ElEQVQY03WP2QqDUAxEfXRFURFXFNz35f//LWWmXKmlfRi8ScjxRMuyTKIoupOmqaCX5zm/SZJIURTsY16WJRPHMWvMETXX2raVeZ6ZaZpk2zZZloV13/eEqWXLssQwDMY0zUfQc11XNCyu60rAdV1ynifrYRhYj+NIqK7r4jiO2Lb9M/iZ53lvIMwAOI6DdqhhB/uu68T3/dsKiwqg3g8gAPu+MzBC8AYc4KZpJAgCCcOQpwMO8F/Duq5pAxNY4kRlh9MBrKqKIJyMfJp9A18e4pydWR22XwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624111750024\"\n        title=\"image-20220624111750024\"\n        src=\"/static/ad3082354693c0191035524272008aa9/b97f6/image-20220624111750024.png\"\n        srcset=\"/static/ad3082354693c0191035524272008aa9/5a46d/image-20220624111750024.png 300w,\n/static/ad3082354693c0191035524272008aa9/0a47e/image-20220624111750024.png 600w,\n/static/ad3082354693c0191035524272008aa9/b97f6/image-20220624111750024.png 958w\"\n        sizes=\"(max-width: 958px) 100vw, 958px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>유의미하게 적용하기</p>\n<ul>\n<li>before</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> http<span class=\"token punctuation\">.</span>server\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">from</span> prometheus_client <span class=\"token keyword\">import</span> Histogram<span class=\"token punctuation\">,</span> start_http_server\n\nhistogram <span class=\"token operator\">=</span> Histogram<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'response_time_histogram'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'Response time for a request'</span><span class=\"token punctuation\">,</span>\n        buckets<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.0003</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.00035</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.0004</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.0005</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>BaseHTTPRequestHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_GET</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        start <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>send_response<span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>wfile<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">b\"Histogram Test\"</span><span class=\"token punctuation\">)</span>\n        histogram<span class=\"token punctuation\">.</span>observe<span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    start_http_server<span class=\"token punctuation\">(</span><span class=\"token number\">8081</span><span class=\"token punctuation\">)</span>\n    server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>HTTPServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Handler<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Exporter running on 8081'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server running on 8080'</span><span class=\"token punctuation\">)</span>\n    server<span class=\"token punctuation\">.</span>serve_forever<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>after</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> http<span class=\"token punctuation\">.</span>server\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">from</span> prometheus_client <span class=\"token keyword\">import</span> Histogram<span class=\"token punctuation\">,</span> start_http_server\n\nhistogram <span class=\"token operator\">=</span> Histogram<span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'response_time_histogram'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'Response time for a request'</span><span class=\"token punctuation\">,</span>\n        buckets<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.00028</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.00030</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.0032</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.0034</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>BaseHTTPRequestHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">do_GET</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        start <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>send_response<span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>wfile<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">b\"Histogram Test\"</span><span class=\"token punctuation\">)</span>\n        histogram<span class=\"token punctuation\">.</span>observe<span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    start_http_server<span class=\"token punctuation\">(</span><span class=\"token number\">8081</span><span class=\"token punctuation\">)</span>\n    server <span class=\"token operator\">=</span> http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>HTTPServer<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">'localhost'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> Handler<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Exporter running on 8081'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server running on 8080'</span><span class=\"token punctuation\">)</span>\n    server<span class=\"token punctuation\">.</span>serve_forever<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">## 03.node express framework를 통한 summary 데이터 알아보기</span>\n\n<span class=\"token operator\">-</span> node js<span class=\"token punctuation\">,</span> npm 설치\n\n```sh\napt install <span class=\"token operator\">-</span>y nodejs npm\n\nmkdir agent<span class=\"token operator\">-</span>node\ncd agent<span class=\"token operator\">-</span>node\n\nnpm init <span class=\"token operator\">-</span>y\n\nnpm i express prom<span class=\"token operator\">-</span>client\n\nvim server<span class=\"token punctuation\">.</span>js</code></pre></div>\n<ul>\n<li>server.js </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">const express = require(&#39;express&#39;)\nconst client = require(&#39;prom-client&#39;)\nconst app = express()\n\nconst register = new client.Registry()\nconst summary = new client.Summary({\n        name: &#39;response_time_summary&#39;,\n        help: &#39;Response time for a request&#39;,\n        percentiles: [0.5, 0.9, 0.99],\n        registers: [register]\n})\n\napp.use((req, res, next)=&gt; {\n        req.startTime= Date.now()\n        next()\n})\n\napp.get(&#39;/&#39;,(req, res)=&gt;{\n        res.send(&#39;Summary Test&#39;)\n        summary.observe((Date.now() - req.startTime)/1000)\n})\n\napp.get(&#39;/metrics&#39;, async(req,res)=&gt;{\n        res.end(await register.metrics())\n})\n\nport = 8080\napp.listen(port,()=&gt;{\n        console.log(&#39;Running on ${port}&#39;)\n})</code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">node server.js</code> 실행</p>\n<ul>\n<li>에러 발생</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 958px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQoz22R16rEMAxE85qy6ZWQkN5Dyv//2ywjcLh3dx8GCckeHctaVVUYhgFt26JpGvR9j3me0XUd6rqWep7nyLLsiUmSwPd9mKYJy7L+SfM8D47jwLZtuK4rB6Mokqau6zAMA6/X60vs/zTktGVZMI6jkDGSMo5jMeYQmvLyp5TpX2ONdNd14TgOnOcpkaL5NE1I01TEl/wi+iIkAS8qSoo7VWYcqEhI+im1FvUKMSTRvu8PIXNGDuEnhGH4KAgCWQVzRq6GNe6e/6BxX/d9i8m2bWKyrqsQFkWBsiwfI16imCuxp+o0fAN3j7F/rI5KwwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624135038975\"\n        title=\"image-20220624135038975\"\n        src=\"/static/aa9fae73bf07c339ef684ef040b804e3/b97f6/image-20220624135038975.png\"\n        srcset=\"/static/aa9fae73bf07c339ef684ef040b804e3/5a46d/image-20220624135038975.png 300w,\n/static/aa9fae73bf07c339ef684ef040b804e3/0a47e/image-20220624135038975.png 600w,\n/static/aa9fae73bf07c339ef684ef040b804e3/b97f6/image-20220624135038975.png 958w\"\n        sizes=\"(max-width: 958px) 100vw, 958px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li>\n<p>node 버전 문제</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">nvm install v14.17.5\nnvm use v14.17.5</code></pre></div>\n<ul>\n<li>위로 변경해주고 다시 시작해보면 됨</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 605px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYUlEQVQI113Muw4AEQBEUZ1nQyMUiNCoKMT/f9nISlY2W5zcqYa01rDWwhgDvXfMOVFKgfcetVaEEJBzRozxSinBOQelFKSUpy9irYUxBlrr49mUUnDOwRi7/RNC3LPv6QaWRDHY1gA6/gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624140614870\"\n        title=\"image-20220624140614870\"\n        src=\"/static/b6054620153d5684ebf6ae20263816f1/90cbd/image-20220624140614870.png\"\n        srcset=\"/static/b6054620153d5684ebf6ae20263816f1/5a46d/image-20220624140614870.png 300w,\n/static/b6054620153d5684ebf6ae20263816f1/0a47e/image-20220624140614870.png 600w,\n/static/b6054620153d5684ebf6ae20263816f1/90cbd/image-20220624140614870.png 605w\"\n        sizes=\"(max-width: 605px) 100vw, 605px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n</li>\n</ul>\n<h2 id=\"03해당-서버로-요청하기\" style=\"position:relative;\"><a href=\"#03%ED%95%B4%EB%8B%B9-%EC%84%9C%EB%B2%84%EB%A1%9C-%EC%9A%94%EC%B2%AD%ED%95%98%EA%B8%B0\" aria-label=\"03해당 서버로 요청하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>03.해당 서버로 요청하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">watch -n 0.1 &#39;curl -s http://localhost:8080&#39;\n\n curl -s http://localhost:8080/metrics</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 479px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQoz41Q207CUBDkRwxyEbkUEBAoagu0QOmNcnpKyx0xSEyMif//Mu45RI1vPmw2u5mZnZ2U6y1gmD5GkwBD6urDCJo+RVc10e2ZGBgetL4NfeDAHM8I48F2OCZTJjlaf4pCsYVsvo7czR1S/iyRAo4XYUwAgwiiT6y5JAmhWbDEE2EaLQ3Nex31xiMqVVUeb9Iuk6v9Ctoul5cnFsOYRATZ9xPqCRw3gjHy4fkxOXWhkuM5W2PqhGRgQZ1DGLIJV1Y6Ujhl2Qz9oQOdrOsDGxa5MkYXl0MS6dPOJFHLDmn2EC324NEOId+ChRuE0VZGUCy3L4Lb/RstDwjYDozvcTi+yzlenohwIYZ8I8kBW4EvdjIi8bJS66FU6ZC7LvKFhnw79Xz8wHJ1xnJ9Rrx6RZyc8HL6pBg4Be6hSqTvd9IZRdZ1tvpTYv8nQ6WmoqJ0JKlUaeO21JLzVbpMBEWCBfA/JUS/ADUR88MXkTmLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20220624142310396\"\n        title=\"image-20220624142310396\"\n        src=\"/static/0ecc579ea1872c9c256627995bdd493f/a9b70/image-20220624142310396.png\"\n        srcset=\"/static/0ecc579ea1872c9c256627995bdd493f/5a46d/image-20220624142310396.png 300w,\n/static/0ecc579ea1872c9c256627995bdd493f/a9b70/image-20220624142310396.png 479w\"\n        sizes=\"(max-width: 479px) 100vw, 479px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<ul>\n<li>퍼센트별 몇초 안에 들어오는지 확인 할수 있음</li>\n</ul>","frontmatter":{"title":"Prometheus 메트릭 유형 알아보기","date":"June 24, 2022"}}},"pageContext":{"slug":"/Prometheus/2022-06-24-[Promethues]메트릭-유형-알아보기/","previous":{"fields":{"slug":"/Algorithm/2022-06-23-2017카카오코드예선-카카오프렌즈-컬러링북/"},"frontmatter":{"title":"2017카카오코드예선 카카오프렌즈 컬러링북"}},"next":{"fields":{"slug":"/Prometheus/2022-06-24-[Prometheus]PromQL알아보기/"},"frontmatter":{"title":"Prometheus PromQL알아보기"}}}},"staticQueryHashes":["2486386679","3128451518"]}